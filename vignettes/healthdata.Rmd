---
title: "What Does Global Health Governance Look Like?"
author: "Jael Tan and Esther Peev"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{What Does Global Health Governance Look Like?}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## manyhealth Data

`{manyhealth}` package is composed of multiple datacubes, each of them representing a different aspect of global health governance. These include data on health agreements, state memberships to these agreements, the lineage of these agreements, and organizations involved in global health governance.

### Agreements

The **agreements** datacube is an ensemble of data on international health instruments. The combination of datasets that are contained in this datacube provides an overview of all international instruments that govern the global health sphere. With the agreements data, we can see for example all the health treaties signed in a specific year, or all WHO instruments adopted during a year. The HUGGO dataset contains handcoded data with more precise dates of adoption and, where applicable, entry into force for each instrument, as well as the broad topic of each instrument and identifies whether the instrument is formal/legally-binding, or not.

```{r agreements, warning=FALSE, message=FALSE, fig.align='center', fig.asp=1.2, fig.width=7}
library(dplyr)
library(knitr)
manyhealth::agreements$WHO[,c(1:5)] %>% 
  dplyr::filter(Begin == "2010") %>% 
  kable("html")

manyhealth::agreements$GHHR[,c(1:5)] %>% 
  dplyr::filter(Begin == "1948") %>% 
  kable("html")

manyhealth::agreements$HUGGO[,c(1:5, 8, 13)] %>% 
  dplyr::filter(messydates::year(Begin) == "1990") %>% 
  kable("html")

```


### Memberships

The **memberships** datacube contains hand-coded data on states' memberships to instruments governing the global health sphere. The `HUGGO_MEM` dataset includes specific dates, where available, of the adoption/signature, ratification, entry into force, and termination by each state during its membership to an agreement. States that have predecessor or successor entities since 1945 are also identified in the Succession variable. The graph below illustrates the membership of the United States and China to international health agreements in the 2000s.

```{r memberships, warning=FALSE, message=FALSE, fig.align='center', fig.asp=1.2, fig.width=7}
library(dplyr)
library(knitr)
library(manynet)

manyhealth::memberships$HUGGO_MEM %>%
  dplyr::filter(messydates::year(Begin) > "1999" & messydates::year(Begin) < "2010") %>% 
  dplyr::filter(stateID == "USA" | stateID == "CHN") %>%
  as_tidygraph() %>%
  mutate_ties(color = ifelse(to == 47, "China", "USA")) %>%
  autographr(edge_color = "color")

```

### Organizations

The **organizations** datacube lists different actors playing a role in the global health governance, such as NGOs, IGOs or associations with their date of establishment and headquarter location. For example, the table below shows the organizations that are based in London.

```{r organizations, warning=FALSE, message=FALSE, fig.align='center', fig.asp=1.2, fig.width=7}
library(dplyr)
library(knitr)
manyhealth::organizations$CHATHAM %>%
  dplyr::filter(City == "London") %>% 
  kable("html")

```


### References

The **references** datacube was hand-coded from agreement texts and identifies which agreements are cited by other agreements. With this information we can, for example, get to treaty lineages. The code below illustrates how to extract sample of treaties from the references datacube and how we can use `{manynet}` to plot treaties that cite other treaties. The first graph employs data from the GHHR_REF dataset. There is a significant amount of overlap between health and human rights issues in some of these agreements.

```{r lineage, warning=FALSE, message=FALSE, fig.align='center', fig.asp=1.2, fig.width=7}
library(dplyr)
library(ggplot2)
library(manynet)

# Get dataset
references <- manyhealth::references$GHHR_REF %>% 
  dplyr::distinct() %>%
  dplyr::mutate(year = stringr::str_extract(Treaty1, "[:digit:]{4}")) %>%
  dplyr::filter(RefType == "Cites") %>%
  dplyr::arrange(year) %>%
  dplyr::filter(Treaty2 == "UNVDHR_1948R")

# Plot with migraph
references %>%
  as_tidygraph() %>%
  mutate(rank = ifelse(name == "UNVDHR_1948R", 1, 2)) %>%
  mutate_ties(period = ifelse(year < 1960, "1950s",
                              ifelse(year < 1970, "1960s",
                                     ifelse(year < 1980, "1970s",
                                            ifelse(year < 1990, "1980s",
                                                   ifelse(year < 2000, "1990s", "2000s")))))) %>%
  autographr(layout = "lineage", rank = "rank", edge_color = "period") +
  scale_edge_color_sdgs() +
  labs(title = "Agreements Citing the Universal Declaration of Human Rights from the GHHR Dataset",
       caption = "Source: manyhealth") +
  theme(plot.title = element_text(family = "sans",
                                  size = 12,
                                  hjust = 0.5))
```


The second graph below illustrate lineages between a sample of treaties from World Health Organization (WHO) dataset. It includes mostly resolutions, decisions and conventions adopted under the auspice of WHO. 

```{r lin, warning=FALSE, message=FALSE, fig.align='center', fig.asp=1.2, fig.width=7}
# Get dataset
references <- manyhealth::references$WHO_REF %>% 
  dplyr::distinct() %>%
  dplyr::mutate(year = stringr::str_extract(Treaty1, "[:digit:]{4}")) %>%
  dplyr::filter(RefType == "Cites") %>%
  dplyr::arrange(year) %>%
  dplyr::filter(Treaty2 == "FRMWTC_2003A" | Treaty2 == "GLDPAH_2004S" | Treaty2 == "GLPCND_2000S")

# Plot with migraph
references %>%
  as_tidygraph() %>%
  mutate(rank = ifelse(name == "FRMWTC_2003A" | name == "GLDPAH_2004S" | name == "GLPCND_2000S",
                       1, 2)) %>%
  mutate_ties(period = ifelse(year < 2010, "2000s", "2010s")) %>%
  autographr(layout = "lineage", rank = "rank", edge_color = "period") +
  scale_edge_color_iheid() +
  labs(title = "Treaty Lineage of Selected Agreements from WHO",
       caption = "Source: manyhealth") +
  theme(plot.title = element_text(family = "sans",
                                  size = 16,
                                  hjust = 0.5))
```

For more information on how to interpret manyIDs, please read this [vignette](https://globalgov.github.io/manypkgs/articles/agreements.html) from `{manypkgs}` package. For access to more data and information in our other "many" packages, please see [manydata](https://github.com/globalgov/manydata).
